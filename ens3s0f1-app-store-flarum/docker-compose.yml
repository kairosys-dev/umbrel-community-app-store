version: "3.7"

services:
  app_proxy:
    environment:
      # <app-id>_<web-container-name>_1
      # e.g. 'btc-rpc-explorer_web_1'
      # Note that the '_1' at the end is needed
      APP_HOST: ens3s0f1-app-store-flarum_flarum_1
      APP_PORT: 8888
  
  flarum:
    image: mondedie/flarum:latest@sha256:a995b0143e6ae7e23768f95a75ceca223b9425f878c85dc45361fb8effcfaa89
    container_name: flarum
    volumes:
      - ${APP_DATA_DIR}/assets:/flarum/app/public/assets
      - ${APP_DATA_DIR}/extensions:/flarum/app/extensions
      - ${APP_DATA_DIR}/logs:/flarum/app/storage/logs
      - ${APP_DATA_DIR}/nginx:/etc/nginx/flarum
    environment:
      - DEBUG=false
      - FORUM_URL=http://$DEVICE_DOMAIN_NAME:8888

      # Database configuration
      - DB_HOST=mariadb
      - DB_NAME=flarum
      - DB_USER=flarum
      - DB_PASS=m5F8v1Q3t9L2c6W0y7Zp
      - DB_PREF=flarum_
      - DB_PORT=3306

      # User configuration
      - FLARUM_ADMIN_USER=admin
      - FLARUM_ADMIN_PASS=G7d2K9q4V1p8Z3s6X0rB
      - FLARUM_ADMIN_MAIL=admin@$DEVICE_DOMAIN_NAME
      - FLARUM_TITLE=Flarum
      # Pass any environment variables to your app for configuration in the form:
      # VARIABLE_NAME: value
      #
      # Here are all the Umbrel provided variables that you can pass through to
      # your app
      # System level environment variables
      # $DEVICE_HOSTNAME - Umbrel server device hostname (e.g. "umbrel")
      # $DEVICE_DOMAIN_NAME - A .local domain name for the Umbrel server (e.g. "umbrel.local")
      #
      # Tor proxy environment variables
      # $TOR_PROXY_IP - Local IP of Tor proxy
      # $TOR_PROXY_PORT - Port of Tor proxy
      #
      # App specific environment variables
      # $APP_HIDDEN_SERVICE - The address of the Tor hidden service your app will be exposed at
      # $APP_PASSWORD - Unique plain text password that can be used for authentication in your app, shown to the user in the Umbrel UI
      # $APP_SEED - Unique 256 bit long hex string (128 bits of entropy) deterministically derived from user's Umbrel seed and your app's ID
  # If your app has more services, like a database container, you can define those
  # services below:
  # db:
  #   image: <docker-image>:<tag>@sha256:<digest>
  #   ...
    depends_on:
      - mariadb
  
  mariadb:
    image: mariadb:10.5
    container_name: mariadb
    environment:

      - MYSQL_ROOT_PASSWORD=G7d2K9q4V1p8Z3s6X0rB
      - MYSQL_DATABASE=flarum
      - MYSQL_USER=flarum
      - MYSQL_PASSWORD=m5F8v1Q3t9L2c6W0y7Zp
    volumes:
      - ${APP_DATA_DIR}/db:/var/lib/mysql
